{% extends 'base.html' %}

{% block content %}
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul class="flashes">
      {% for message in messages %}
      <li{% if 'error' in message %} class="error"{% endif %}>{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}
<div class="container">
    <h1>Welcome to your dashboard, {{ current_user.name }}{% if current_user.is_admin %} (admin){% endif %}</h1>

    <form action="{{ url_for('dashboard') }}" method="POST" class="mb-3">
        <div class="form-group">
            <label for="content">Add a new note:</label>
            <textarea name="content" id="content" rows="4" class="form-control" required></textarea>
        </div>
        <div class="form-group">
            <label for="group_id">Group:</label>
            <select name="group_id" class="form-control">
                <option value="">None</option>
                {% for group in current_user.groups %}
                    <option value="{{ group.id }}">{{ group.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="member_id">Member:</label>
            <select name="member_id" class="form-control">
                <option value="">None</option>
                {% for member in current_user.members %}
                    <option value="{{ member.id }}">{{ member.name }}</option>
                {% endfor %}
            </select>
        </div>
        <input type="submit" value="Add Note" class="btn btn-primary">
    </form>

    <h2>Your Notes:</h2>
    {% for note in notes %}
        <div class="card mb-3">
            <div class="card-body">
                <p>{{ note.content }}</p>
                {% if note.group %}
                    <p>Group: {{ note.group.name }}</p>
                {% endif %}
                {% if note.member %}
                    <p>Member: {{ note.member.name }}</p>
                {% endif %}
                <small class="text-muted">Created at: {{ note.date_created.strftime('%Y-%m-%d %H:%M:%S')}}</small>
                <a href="{{ url_for('delete_note', note_id=note.id) }}" class="btn btn-danger btn-sm">Delete</a>
            </div>
        </div>
    {% endfor %}

    <h2>Your Members:</h2>
    <ul class="list-group mb-3">
        {% for member in current_user.members %}
            <li class="list-group-item">{{ member.name }}{% if member.is_admin %} (admin){% endif %}</li>
        {% endfor %}
    </ul>

    <h2>Your Groups:</h2>
    <ul class="list-group mb-3">
        {% for group in current_user.groups %}
            <li class="list-group-item">{{ group.name }}</li>
        {% endfor %}
    </ul>

    <a href="{{ url_for('members') }}" class="btn btn-info">Manage Members</a>
    <br>
    <a href="{{ url_for('groups') }}" class="btn btn-info mt-2">Manage Groups</a>
    <br>
    <a href="{{ url_for('logout') }}" class="btn btn-danger mt-2">Logout</a>
</div>
{% endblock %}
